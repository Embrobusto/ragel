include '../src/ragel.lm'

OutputFile: str = argv.pop()
InputFile: str = argv.pop()
Lang: str = argv.pop()

def start
	[c_host::section*]

Input: stream = open( InputFile "r" )
Output: stream = open( OutputFile "w" )

RagelTree: start = parse start[ Input ]

prints( Output
	"/*
	" * @LANG: [Lang]
	" * @GENERATED: yes
	" */
)

for Section: c_host::section in RagelTree {
	if match Section [c_host::'%%' ragel::inline_expr ragel::';'] ||
		match Section [c_host::'%%{' ragel::ragel_start c_host::'}%%']
	{
		prints( Output Section )
	}
}
