#!/bin/bash
#

while getopts "h-:" opt; do
	case $opt in
		-)
			WITH=${OPTARG/=*/}
			VAL=${OPTARG/*=/}
			LOG_ARGS="$LOG_ARGS --$OPTARG"
			case $WITH in
				with-aapl)
					WITH_AAPL=$VAL
				;;
				with-colm)
					WITH_COLM=$VAL
				;;
				with-ragel)
					WITH_RAGEL=$VAL
				;;
				with-genf)
					WITH_GENF=$VAL
				;;
				*)
					echo "$0: unrecognized option --$OPTARG" >&2
					exit 1
				;;
			esac

		;;
	esac
done

set -xe

cd public
./configure --with-aapl=$WITH_AAPL --with-colm=$WITH_COLM --with-ragel=$WITH_RAGEL
cd ..

cd cases
./configure --with-aapl=$WITH_AAPL --with-colm=$WITH_COLM --with-ragel=$WITH_RAGEL
cd ..

root=$(pwd)

cd genf/app1.d
./configure --prefix=$root/genf/inst/app1 --with-aapl=$WITH_AAPL --with-subject=$WITH_GENF
cd ../..

cd genf/kern1.d
./configure --prefix=$root/genf/inst/kern1 --with-aapl=$WITH_AAPL --with-subject=$WITH_GENF
cd ../..


echo ./configure $LOG_ARGS > config.log
